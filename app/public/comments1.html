<html>

<head>
  <link rel="stylesheet" type="text/css" href="style.css" />
  <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/1.0.11/purify.js"></script>
</head>


<body>
  <center>

    <table id="hnmain" border="0" cellpadding="0" cellspacing="0" width="85%" bgcolor="#f6f6ef">
      <tbody>
        <tr>
          <td bgcolor="#E3B747">
            <table border="0" cellpadding="0" cellspacing="0" width="100%" style="padding:2px">
              <tbody>
                <tr>
                  <td style="width:18px;padding-right:4px"><a href="https://news.ycombinator.com"><img src="bsvlogo.svg" width="18" height="18" style="border:1px white solid;border-radius:50%"></a></td>
                  <td style="line-height:12pt; height:10px;"><span class="pagetop"><b class="hnname"><a href="news">BSV News</a></b>
                      <a href="newswelcome.html">welcome</a> | <a href="newest">new</a> | <a href="newcomments">comments</a> | <a href="ask">ask</a> | <a href="show">show</a> | <a href="jobs">jobs</a> | <a href="submit">submit</a> </span></td>
                </tr>
              </tbody>
            </table>
          </td>
        </tr>
        <tr id="pagespace" title="" style="height:10px"></tr>
        <tr>
          <td>
            <table border="0" cellpadding="0" cellspacing="0" class="itemlist">
              <tbody id="tcontent">
              </tbody>
          </td>
        </tr>
      </tbody>
    </table>
  </center>
</body>




<script type="text/javascript">
  $(document).ready(function() {

    function getParameterByName(name) {
      var regexS = "[\\?&]" + name + "=([^&#]*)",
        regex = new RegExp(regexS),
        results = regex.exec(window.location.search);
      if (results == null) {
        return "";
      } else {
        return decodeURIComponent(results[1].replace(/\+/g, " "));
      }
    }

    var index = DOMPurify.sanitize(getParameterByName('index'));
    var tx = DOMPurify.sanitize(getParameterByName('tx'));
    if (!(parseInt(index) > 0)) {
      index = '0'
    }
    $.post("/tx/" + tx + "/count/" + index, function(data) {
      console.log(data);
      var outputs = []

      data.forEach(function(item){
        var info = item.out;
        info.tx = item._id;
        if(info.hasOwnProperty('s3') && info.hasOwnProperty('s4') && info.hasOwnProperty('s5') && info.hasOwnProperty('tx')){
          outputs.push(info);
        }else{
          console.log(info);
          outputs.push({"s3":"invalid formatting","s4":"invalid formatting","s5":"invalid formatting","tx":"invalid formatting"})
        }

      })
      console.log(outputs);
      rank = parseInt(index) * 30;
      outputs.forEach(function(element) {

        rank = rank + 1;

        document.getElementById("tcontent").innerHTML = document.getElementById("tcontent").innerHTML +
          ` <tr class="athing" id="rank${rank}">
             <td align = "right" valign = "top" class = "title"> <span class = "rank">${rank}.</span></td>
             <td valign = "top" class = "votelinks">
                <center>
                  <a id = "${DOMPurify.sanitize(element.tx)}" onclick = "upvote('#'+${DOMPurify.sanitize(element.tx)})">
                    <div class = "votearrow" title = "upvote"> </div>
                  </a>
                 </center>
             </td>
             <td class = "title"> <a href = "${DOMPurify.sanitize(element.s5)}" class = "storylink" > ${DOMPurify.sanitize(element.s3)} </a>
                <span class="sitebit comhead"> (<a href="${DOMPurify.sanitize(element.s5)}"><span class="sitestr">${DOMPurify.sanitize(element.s4)}</span > </a>)</span>
             </td>
            </tr>
            <tr>
              <td colspan="2"></td>
              <td class="subtext">
                <span class="score" id="score_20676904">413 points</span> by <a href="user?id=dublin" class="hnuser">${DOMPurify.sanitize(element.s4)}</a>
                <span class="age"><a href="item?id=20676904">2 hours ago</a></span> <span id="unv_20676904"></span> |
                <a href="hide?id=20676904&amp;auth=d44e0e7e5a7875872cae4e1d0b9e6ca3a397e8e4&amp;goto=news" onclick="return hidestory(event, this, 20676904)">hide</a> |
                <a href="item?id=20676904">235&nbsp;comments</a>
              </td>
            </tr>
            <tr class="spacer" style="height:5px"></tr>`;
      })
    });
  })
</script>



</html>
